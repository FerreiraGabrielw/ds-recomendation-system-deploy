<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel Ferreira">
<meta name="dcterms.date" content="2025-12-19">

<title>Hybrid Recommender System for E-commerce (End-to-End)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="RecomendationSystemEN_files/libs/clipboard/clipboard.min.js"></script>
<script src="RecomendationSystemEN_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="RecomendationSystemEN_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="RecomendationSystemEN_files/libs/quarto-html/popper.min.js"></script>
<script src="RecomendationSystemEN_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="RecomendationSystemEN_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RecomendationSystemEN_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RecomendationSystemEN_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RecomendationSystemEN_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RecomendationSystemEN_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="RecomendationSystemEN_files/libs/quarto-contrib/videojs/video.min.js"></script>
<link href="RecomendationSystemEN_files/libs/quarto-contrib/videojs/video-js.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Project Index</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#project-structure" id="toc-project-structure" class="nav-link" data-scroll-target="#project-structure">Project Structure</a></li>
  <li><a href="#business-objectives" id="toc-business-objectives" class="nav-link" data-scroll-target="#business-objectives">Business Objectives</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a></li>
  <li><a href="#eda-exploratory-data-analysis" id="toc-eda-exploratory-data-analysis" class="nav-link" data-scroll-target="#eda-exploratory-data-analysis">EDA (Exploratory Data Analysis)</a></li>
  <li><a href="#algorithm-development" id="toc-algorithm-development" class="nav-link" data-scroll-target="#algorithm-development">Algorithm Development</a></li>
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model">Final Model</a></li>
  <li><a href="#model-conclusion" id="toc-model-conclusion" class="nav-link" data-scroll-target="#model-conclusion">Model Conclusion</a></li>
  <li><a href="#cloud-deployment-aws" id="toc-cloud-deployment-aws" class="nav-link" data-scroll-target="#cloud-deployment-aws">Cloud Deployment (AWS)</a></li>
  <li><a href="#project-conclusion" id="toc-project-conclusion" class="nav-link" data-scroll-target="#project-conclusion">Project Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hybrid Recommender System for E-commerce (End-to-End)</h1>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel Ferreira </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 19, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This project presents the development of a hybrid recommender system for e-commerce, covering the entire lifecycle of a Machine Learning solution applied in a real-world business context.</p>
<p>The main objective is to increase conversion rate and average order value through personalized recommendations, leveraging multiple complementary signals:</p>
<ul>
<li>historical purchase behavior (Collaborative Filtering),</li>
<li>semantic similarity between products (Content-Based),</li>
<li>explicit co-occurrence patterns in shopping baskets (Association Rules).</li>
</ul>
<hr>
</section>
<section id="project-structure" class="level1">
<h1>Project Structure</h1>
<p>The pipeline follows a typical end-to-end architecture for modern recommender systems:</p>
<ol type="1">
<li>Business problem definition</li>
<li>Database creation and data ingestion</li>
<li>SQL-based exploration and validation</li>
<li>Data cleaning and preprocessing</li>
<li>Feature engineering and modeling (CF, CB, AR)</li>
<li>Hybrid model construction</li>
<li>Evaluation and interpretation</li>
<li>Artifact preparation</li>
<li>Deployment (AWS S3, Lambda, API Gateway)</li>
</ol>
<p>This structure ensures a clear separation between data, models, and inference, facilitating maintenance and scalability.</p>
<hr>
</section>
<section id="business-objectives" class="level1">
<h1>Business Objectives</h1>
<p>Increase recommendation relevance to drive:</p>
<ul>
<li>AOV (Average Order Value),</li>
<li>conversion rate,</li>
<li>recommendation CTR,</li>
<li>incremental revenue.</li>
</ul>
<hr>
</section>
<section id="data-sources" class="level1">
<h1>Data Sources</h1>
<p>The data represents a typical transactional e-commerce environment, with normalized tables reflecting standard practices for analytical storage and processing.</p>
<p>The dataset includes:</p>
<ul>
<li>item-level transaction history,</li>
<li>product catalog with descriptive attributes,</li>
<li>product view events,</li>
<li>basic customer demographic information,</li>
<li>temporal records for behavioral analysis.</li>
</ul>
<hr>
<section id="database-setup-sql-exploration" class="level2">
<h2 data-anchor-id="database-setup-sql-exploration">Database Setup &amp; SQL Exploration</h2>
<p>Before any modeling step in Python, the data undergoes a structuring, ingestion, and validation process in a relational database, typical of real-world analytics environments in e-commerce.</p>
<section id="entity-relationship-er-diagram" class="level3">
<h3 data-anchor-id="entity-relationship-er-diagram">Entity-Relationship (ER) Diagram</h3>
<p>The diagram below illustrates the relational database model, highlighting core entities such as customers, products, transactions, and views, as well as their relationships.</p>
<p><strong>Database ER Diagram</strong></p>
<p><img src="ER-diagram.png" class="img-fluid"></p>
</section>
<section id="data-ingestion-validation-in-mysql" class="level3">
<h3 data-anchor-id="data-ingestion-validation-in-mysql">Data Ingestion &amp; Validation in MySQL</h3>
<p>After defining the schema, the tables are created and data is loaded directly into the database using command-line tools and MySQL Workbench, reproducing common ingestion practices in analytical environments.</p>
<section id="database-and-table-creation" class="level5">
<h5 data-anchor-id="database-and-table-creation">Database and table creation:</h5>
<details>
<summary>
<strong>Show SQL Schema</strong>
</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Criar banco de dados</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> ecommerce_db</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DEFAULT</span> <span class="dt">CHARACTER</span> <span class="kw">SET</span> utf8mb4</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">DEFAULT</span> COLLATE utf8mb4_unicode_ci;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> ecommerce_db;</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Tabela: customers</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> customers (</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    customer_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">150</span>) <span class="kw">UNIQUE</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    gender ENUM(<span class="st">'M'</span>,<span class="st">'F'</span>,<span class="st">'O'</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    age TINYINT UNSIGNED <span class="kw">NULL</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    city <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    state <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    registration_date DATETIME <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (customer_id)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>) ENGINE<span class="op">=</span>InnoDB;</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">-- Tabela: products</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> products (</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    product_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">150</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">category</span> <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    brand <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    price <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    created_at DATETIME <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    is_active TINYINT(<span class="dv">1</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">1</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (product_id),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_products_category (<span class="kw">category</span>),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_products_brand (brand)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>) ENGINE<span class="op">=</span>InnoDB;</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">-- Tabela: transactions</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> transactions (</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    transaction_id BIGINT UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    customer_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    product_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    quantity <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">1</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    total_value <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    transaction_date DATETIME <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (transaction_id),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_transactions_customer (customer_id),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_transactions_product (product_id),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_transactions_date (transaction_date),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> fk_transactions_customer</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (customer_id) <span class="kw">REFERENCES</span> customers(customer_id)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> fk_transactions_product</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (product_id) <span class="kw">REFERENCES</span> products(product_id)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">RESTRICT</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>) ENGINE<span class="op">=</span>InnoDB;</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">-- Tabela: product_views</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> product_views (</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    view_id BIGINT UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span> AUTO_INCREMENT,</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    customer_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    product_id <span class="dt">INT</span> UNSIGNED <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    view_datetime DATETIME <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    session_id <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    device_type ENUM(<span class="st">'desktop'</span>,<span class="st">'mobile'</span>,<span class="st">'tablet'</span>) <span class="kw">NULL</span>,</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (view_id),</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_views_customer (customer_id),</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_views_product (product_id),</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INDEX</span> idx_views_datetime (view_datetime),</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> fk_views_customer</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (customer_id) <span class="kw">REFERENCES</span> customers(customer_id)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> fk_views_product</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (product_id) <span class="kw">REFERENCES</span> products(product_id)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">RESTRICT</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>) ENGINE<span class="op">=</span>InnoDB;</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co">-- Verificação final</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co">-- =========================================================</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>DESCRIBE customers;</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>DESCRIBE products;</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>DESCRIBE transactions;</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>DESCRIBE product_views;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<hr>
</section>
<section id="loading-data-into-the-database-via-command-line" class="level5">
<h5 data-anchor-id="loading-data-into-the-database-via-command-line">Loading data into the database via command line:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video1" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="SQL-DB-CREATION.mp4"></video></div>
</section>
<section id="execution-of-initial-exploratory-queries" class="level5">
<h5 data-anchor-id="execution-of-initial-exploratory-queries">Execution of initial exploratory queries:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video2" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="SQL-QUERIES.mp4"></video></div>
<hr>
</section>
</section>
</section>
</section>
<section id="eda-exploratory-data-analysis" class="level1">
<h1>EDA (Exploratory Data Analysis)</h1>
<section id="python-function-to-run-pure-sql-on-notebook" class="level5">
<h5 data-anchor-id="python-function-to-run-pure-sql-on-notebook">Python Function to run pure SQL on notebook:</h5>
<div id="5b90c871" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_sql_pure(sql: <span class="bu">str</span>, params: <span class="bu">dict</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Executa SQL puro (string) e retorna um pandas.DataFrame.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Exibe a query e retorna o DataFrame.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---- Executing SQL ----"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(sql.strip())</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-----------------------"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_sql_query(sql<span class="op">=</span>text(sql), con<span class="op">=</span>engine, params<span class="op">=</span>params)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    display(df.head(<span class="dv">10</span>))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuração do matplotlib</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">5</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'grid.linestyle'</span>] <span class="op">=</span> <span class="st">'--'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>The first step of the EDA is to validate the structural integrity of the tables.</p>
</section>
<section id="record-counts-per-table" class="level5">
<h5 data-anchor-id="record-counts-per-table">Record counts per table:</h5>
<div id="e60aa2b0" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">  (SELECT COUNT(*) FROM customers) AS n_customers,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">  (SELECT COUNT(*) FROM products)  AS n_products,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">  (SELECT COUNT(*) FROM transactions) AS n_transactions,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">  (SELECT COUNT(*) FROM product_views) AS n_views;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> df.iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> <span class="bu">list</span>(vals.keys())<span class="op">;</span> counts <span class="op">=</span> <span class="bu">list</span>(vals.values())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT 
  (SELECT COUNT(*) FROM customers) AS n_customers,
  (SELECT COUNT(*) FROM products)  AS n_products,
  (SELECT COUNT(*) FROM transactions) AS n_transactions,
  (SELECT COUNT(*) FROM product_views) AS n_views;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_customers</th>
<th data-quarto-table-cell-role="th">n_products</th>
<th data-quarto-table-cell-role="th">n_transactions</th>
<th data-quarto-table-cell-role="th">n_views</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1000</td>
<td>300</td>
<td>21123</td>
<td>70000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="missing-values-per-table" class="level5">
<h5 data-anchor-id="missing-values-per-table">Missing values per table:</h5>
<div id="7f9b102f" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lista de tabelas a verificar</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> [<span class="st">'customers'</span>, <span class="st">'products'</span>, <span class="st">'transactions'</span>, <span class="st">'product_views'</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> tables:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    q_cols <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT COLUMN_NAME</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM INFORMATION_SCHEMA.COLUMNS</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE TABLE_SCHEMA = '</span><span class="sc">{</span>DB_NAME<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND TABLE_NAME = '</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    ORDER BY ORDINAL_POSITION;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    cols_df <span class="op">=</span> pd.read_sql_query(sql<span class="op">=</span>text(q_cols), con<span class="op">=</span>engine)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> cols_df[<span class="st">'COLUMN_NAME'</span>].tolist()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> <span class="bu">len</span>(cols)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># contar linhas</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    q_rows <span class="op">=</span> <span class="ss">f"SELECT COUNT(*) AS n_rows FROM </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">;"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    n_rows <span class="op">=</span> pd.read_sql_query(sql<span class="op">=</span>text(q_rows), con<span class="op">=</span>engine).iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_rows <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> num_cols <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        null_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        null_expr <span class="op">=</span> <span class="st">" + "</span>.join([<span class="ss">f"SUM(`</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">` IS NULL)"</span> <span class="cf">for</span> c <span class="kw">in</span> cols])</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        q_nulls <span class="op">=</span> <span class="ss">f"SELECT </span><span class="sc">{</span>null_expr<span class="sc">}</span><span class="ss"> AS null_count FROM </span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">;"</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        null_count <span class="op">=</span> pd.read_sql_query(sql<span class="op">=</span>text(q_nulls), con<span class="op">=</span>engine).iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    total_cells <span class="op">=</span> <span class="bu">int</span>(n_rows) <span class="op">*</span> <span class="bu">int</span>(num_cols)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    pct_null <span class="op">=</span> (null_count <span class="op">/</span> total_cells <span class="op">*</span> <span class="dv">100</span>) <span class="cf">if</span> total_cells <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    results.append({</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"table"</span>: t,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_rows"</span>: <span class="bu">int</span>(n_rows),</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_cols"</span>: <span class="bu">int</span>(num_cols),</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"total_cells"</span>: <span class="bu">int</span>(total_cells),</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"null_count"</span>: <span class="bu">int</span>(null_count),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pct_null"</span>: <span class="bu">round</span>(pct_null, <span class="dv">4</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>df_missing_tables <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>display(df_missing_tables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">n_rows</th>
<th data-quarto-table-cell-role="th">n_cols</th>
<th data-quarto-table-cell-role="th">total_cells</th>
<th data-quarto-table-cell-role="th">null_count</th>
<th data-quarto-table-cell-role="th">pct_null</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>customers</td>
<td>1000</td>
<td>8</td>
<td>8000</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>products</td>
<td>300</td>
<td>7</td>
<td>2100</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>transactions</td>
<td>21123</td>
<td>6</td>
<td>126738</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>product_views</td>
<td>70000</td>
<td>6</td>
<td>420000</td>
<td>0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="duplicates-and-keys-primary-key-uniqueness-check" class="level5">
<h5 data-anchor-id="duplicates-and-keys-primary-key-uniqueness-check">Duplicates and keys (primary key uniqueness check):</h5>
<div id="78bfb7d3" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">  COUNT(*) AS total_rows,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">  COUNT(DISTINCT transaction_id) AS distinct_transaction_id,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">  COUNT(DISTINCT CONCAT(customer_id,'-',DATE(transaction_date))) AS distinct_cust_date</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT 
  COUNT(*) AS total_rows,
  COUNT(DISTINCT transaction_id) AS distinct_transaction_id,
  COUNT(DISTINCT CONCAT(customer_id,'-',DATE(transaction_date))) AS distinct_cust_date
FROM transactions;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_rows</th>
<th data-quarto-table-cell-role="th">distinct_transaction_id</th>
<th data-quarto-table-cell-role="th">distinct_cust_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>21123</td>
<td>21123</td>
<td>11804</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> total_rows  distinct_transaction_id  distinct_cust_date
      21123                    21123               11804</code></pre>
</div>
</div>
<p><br></p>
<p>The results confirm that the data is complete and consistent, allowing the analysis to proceed without the need for structural data cleaning.</p>
<hr>
</section>
<section id="visualizations-and-insights" class="level3">
<h3 data-anchor-id="visualizations-and-insights">Visualizations and Insights</h3>
<p>At this stage, we explore business behavior using SQL-based analyses.</p>
<section id="product-price-distribution" class="level5">
<h5 data-anchor-id="product-price-distribution">Product price distribution:</h5>
<div id="b601a9be" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"SELECT price FROM products WHERE price IS NOT NULL;"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_price <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_price[<span class="st">'price'</span>] <span class="op">=</span> pd.to_numeric(df_price[<span class="st">'price'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.hist(df_price[<span class="st">'price'</span>].dropna(), bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Product Price Distribution"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Price"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Frequency"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT price FROM products WHERE price IS NOT NULL;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1348.64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1231.56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>442.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1459.57</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>471.71</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>426.05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>306.27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1119.19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1236.90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>126.46</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-8-output-3.png" width="808" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="top-products-by-quantity-sold-and-by-revenue" class="level5">
<h5 data-anchor-id="top-products-by-quantity-sold-and-by-revenue">Top products by quantity sold and by revenue:</h5>
<div id="dde78c06" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT p.product_id, p.name,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">       SUM(t.quantity) AS total_qty,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">       SUM(t.total_value) AS total_revenue</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions t</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN products p ON t.product_id = p.product_id</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY p.product_id</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY total_qty DESC</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">LIMIT 10;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>df_top <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> df_top.plot.bar(x<span class="op">=</span><span class="st">'name'</span>, y<span class="op">=</span><span class="st">'total_qty'</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">70</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Top 15 products by quantity sold"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Quantity"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># revenue bar</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>df_top.plot.bar(x<span class="op">=</span><span class="st">'name'</span>, y<span class="op">=</span><span class="st">'total_revenue'</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">70</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Top 15 Revenue-Generating Products"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Revenue"</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT p.product_id, p.name,
       SUM(t.quantity) AS total_qty,
       SUM(t.total_value) AS total_revenue
FROM transactions t
JOIN products p ON t.product_id = p.product_id
GROUP BY p.product_id
ORDER BY total_qty DESC
LIMIT 10;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">total_qty</th>
<th data-quarto-table-cell-role="th">total_revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>251</td>
<td>Acessórios Oakley Eos</td>
<td>217.0</td>
<td>186915.12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>192</td>
<td>Acessórios Rayban Molestiae</td>
<td>211.0</td>
<td>108861.23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>95</td>
<td>Acessórios Oakley Repellat</td>
<td>205.0</td>
<td>18025.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>82</td>
<td>Acessórios Rayban Iure</td>
<td>205.0</td>
<td>185129.35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>177</td>
<td>Acessórios Oakley Quo</td>
<td>195.0</td>
<td>221867.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>161</td>
<td>Acessórios Samsung Earum</td>
<td>193.0</td>
<td>279170.64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>235</td>
<td>Acessórios Rayban Ullam</td>
<td>185.0</td>
<td>156080.80</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>169</td>
<td>Acessórios Rayban Repudiandae</td>
<td>184.0</td>
<td>211294.56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>211</td>
<td>Acessórios Oakley Iste</td>
<td>183.0</td>
<td>91657.38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>49</td>
<td>Acessórios Rayban Harum</td>
<td>182.0</td>
<td>64921.22</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-9-output-3.png" width="816" height="603" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-9-output-4.png" width="842" height="603" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="monthly-sales" class="level5">
<h5 data-anchor-id="monthly-sales">Monthly sales:</h5>
<div id="2dabb87f" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT DATE_FORMAT(transaction_date, '%Y-%m') AS ym,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">       COUNT(*) AS n_items,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">       SUM(total_value) AS revenue</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY ym</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY ym;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>df_ts <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>df_ts[<span class="st">'ym'</span>] <span class="op">=</span> pd.to_datetime(df_ts[<span class="st">'ym'</span>] <span class="op">+</span> <span class="st">'-01'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.plot(df_ts[<span class="st">'ym'</span>], df_ts[<span class="st">'revenue'</span>])</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Monthly Revenue"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Month"</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Revenue"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT DATE_FORMAT(transaction_date, '%Y-%m') AS ym,
       COUNT(*) AS n_items,
       SUM(total_value) AS revenue
FROM transactions
GROUP BY ym
ORDER BY ym;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ym</th>
<th data-quarto-table-cell-role="th">n_items</th>
<th data-quarto-table-cell-role="th">revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2024-12</td>
<td>965</td>
<td>1078916.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2025-01</td>
<td>1828</td>
<td>2176511.82</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2025-02</td>
<td>1612</td>
<td>1812512.41</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2025-03</td>
<td>1741</td>
<td>2033208.48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2025-04</td>
<td>1806</td>
<td>2085717.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2025-05</td>
<td>1749</td>
<td>2003141.91</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2025-06</td>
<td>1675</td>
<td>1968112.97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2025-07</td>
<td>1915</td>
<td>2197290.58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2025-08</td>
<td>1861</td>
<td>2203234.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2025-09</td>
<td>1632</td>
<td>1932849.30</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-10-output-3.png" width="812" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="rfm-table-and-histograms" class="level5">
<h5 data-anchor-id="rfm-table-and-histograms">RFM — table and histograms:</h5>
<div id="44366aa2" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">WITH last AS (</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT customer_id,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">         DATEDIFF(CURDATE(), MAX(DATE(transaction_date))) AS recency_days,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">         COUNT(*) AS frequency,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">         SUM(total_value) AS monetary</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM transactions</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY customer_id</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT * FROM last;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>df_rfm <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">4</span>))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(df_rfm[<span class="st">'recency_days'</span>].dropna(), bins<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span> axes[<span class="dv">0</span>].set_title(<span class="st">'Recency (dias)'</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(df_rfm[<span class="st">'frequency'</span>].dropna(), bins<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span> axes[<span class="dv">1</span>].set_title(<span class="st">'Frequency'</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].hist(df_rfm[<span class="st">'monetary'</span>].dropna(), bins<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span> axes[<span class="dv">2</span>].set_title(<span class="st">'Monetary'</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter recency x monetary</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_rfm[<span class="st">'recency_days'</span>], df_rfm[<span class="st">'monetary'</span>])</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Recency (days)'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Monetary (total_spent)'</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Recency x Monetary (customer)'</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
WITH last AS (
  SELECT customer_id,
         DATEDIFF(CURDATE(), MAX(DATE(transaction_date))) AS recency_days,
         COUNT(*) AS frequency,
         SUM(total_value) AS monetary
  FROM transactions
  GROUP BY customer_id
)
SELECT * FROM last;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">recency_days</th>
<th data-quarto-table-cell-role="th">frequency</th>
<th data-quarto-table-cell-role="th">monetary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>15</td>
<td>14</td>
<td>14261.37</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>19</td>
<td>26</td>
<td>26203.35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>77</td>
<td>23</td>
<td>25696.87</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>35</td>
<td>26</td>
<td>31203.42</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>128</td>
<td>11</td>
<td>16216.30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>28</td>
<td>29</td>
<td>26575.41</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>40</td>
<td>20</td>
<td>21554.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>39</td>
<td>22</td>
<td>31804.66</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>27</td>
<td>21</td>
<td>24763.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>10</td>
<td>19</td>
<td>18695.84</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-11-output-3.png" width="1170" height="357" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-11-output-4.png" width="833" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="distribution-of-purchases-per-customer" class="level5">
<h5 data-anchor-id="distribution-of-purchases-per-customer">Distribution of purchases per customer:</h5>
<div id="9f1b7346" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT customer_id, COUNT(*) AS purchases</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY customer_id;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>df_purchases <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.hist(df_purchases[<span class="st">'purchases'</span>], bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Purchases per Customer"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of Purchases"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"customer"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT customer_id, COUNT(*) AS purchases
FROM transactions
GROUP BY customer_id;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">purchases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>19</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-12-output-3.png" width="822" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="view-to-purchase-conversion-by-product" class="level5">
<h5 data-anchor-id="view-to-purchase-conversion-by-product">View-to-purchase conversion by product</h5>
<div id="6679bcfc" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT p.product_id, p.name,</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="st">  COALESCE(v.views,0) AS views,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">  COALESCE(b.buys,0)  AS buys,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ROUND(COALESCE(b.buys,0) / NULLIF(COALESCE(v.views,0),0) * 100,2) AS conversion_pct</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">FROM products p</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN (</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT product_id, COUNT(*) AS views</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM product_views</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY product_id</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">) v ON p.product_id = v.product_id</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN (</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT product_id, COUNT(*) AS buys</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM transactions</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY product_id</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">) b ON p.product_id = b.product_id;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>df_conv <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_conv[<span class="st">'views'</span>], df_conv[<span class="st">'buys'</span>])</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Views'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'Buys'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Views x Buys (products)'</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT p.product_id, p.name,
  COALESCE(v.views,0) AS views,
  COALESCE(b.buys,0)  AS buys,
  ROUND(COALESCE(b.buys,0) / NULLIF(COALESCE(v.views,0),0) * 100,2) AS conversion_pct
FROM products p
LEFT JOIN (
  SELECT product_id, COUNT(*) AS views
  FROM product_views
  GROUP BY product_id
) v ON p.product_id = v.product_id
LEFT JOIN (
  SELECT product_id, COUNT(*) AS buys
  FROM transactions
  GROUP BY product_id
) b ON p.product_id = b.product_id;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">views</th>
<th data-quarto-table-cell-role="th">buys</th>
<th data-quarto-table-cell-role="th">conversion_pct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Eletrônicos LG Repellendus</td>
<td>254</td>
<td>67</td>
<td>26.38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>Roupas Puma Ad</td>
<td>199</td>
<td>50</td>
<td>25.13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>Acessórios Apple Assumenda</td>
<td>262</td>
<td>120</td>
<td>45.80</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>Eletrônicos Apple Fugit</td>
<td>269</td>
<td>61</td>
<td>22.68</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>Calçados Adidas Nisi</td>
<td>197</td>
<td>51</td>
<td>25.89</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>Eletrônicos LG Architecto</td>
<td>237</td>
<td>48</td>
<td>20.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>Eletrônicos Apple Magni</td>
<td>254</td>
<td>60</td>
<td>23.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>Calçados Mizuno Vero</td>
<td>251</td>
<td>54</td>
<td>21.51</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>Casa Brastemp Accusamus</td>
<td>211</td>
<td>60</td>
<td>28.44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>Casa Tramontina Aut</td>
<td>208</td>
<td>69</td>
<td>33.17</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-13-output-3.png" width="816" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="sales-by-category" class="level5">
<h5 data-anchor-id="sales-by-category">Sales by category:</h5>
<div id="6c81e6fa" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT p.category, COUNT(*) AS n_items, SUM(t.total_value) AS revenue</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions t</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN products p ON t.product_id = p.product_id</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY p.category</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY revenue DESC;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>df_cat <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>df_cat.plot.bar(x<span class="op">=</span><span class="st">'category'</span>, y<span class="op">=</span><span class="st">'revenue'</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Revenue per category"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Revenue"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT p.category, COUNT(*) AS n_items, SUM(t.total_value) AS revenue
FROM transactions t
JOIN products p ON t.product_id = p.product_id
GROUP BY p.category
ORDER BY revenue DESC;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">n_items</th>
<th data-quarto-table-cell-role="th">revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Acessórios</td>
<td>6791</td>
<td>8093968.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Casa</td>
<td>4201</td>
<td>4853473.99</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Roupas</td>
<td>3493</td>
<td>4130537.90</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Eletrônicos</td>
<td>3393</td>
<td>3875183.58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Calçados</td>
<td>3245</td>
<td>3635461.14</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-14-output-3.png" width="799" height="507" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="aov-average-order-value" class="level5">
<h5 data-anchor-id="aov-average-order-value">AOV (Average Order Value):</h5>
<div id="950763fd" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT customer_id, DATE(transaction_date) AS order_date, SUM(total_value) AS order_value</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM transactions</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY customer_id, DATE(transaction_date);</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_orders <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>aov <span class="op">=</span> df_orders[<span class="st">'order_value'</span>].mean()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Order Value (Approx.): R$ </span><span class="sc">{</span>aov<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.hist(df_orders[<span class="st">'order_value'</span>], bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Order Value (Approx.)"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Order value"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT customer_id, DATE(transaction_date) AS order_date, SUM(total_value) AS order_value
FROM transactions
GROUP BY customer_id, DATE(transaction_date);
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">order_date</th>
<th data-quarto-table-cell-role="th">order_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>847</td>
<td>2025-10-23</td>
<td>590.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>61</td>
<td>2025-03-13</td>
<td>1701.93</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>859</td>
<td>2025-03-20</td>
<td>6656.51</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>162</td>
<td>2025-02-09</td>
<td>3413.34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>690</td>
<td>2025-09-10</td>
<td>715.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>938</td>
<td>2025-10-22</td>
<td>2335.58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>457</td>
<td>2025-10-27</td>
<td>2188.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>152</td>
<td>2025-08-30</td>
<td>3409.31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>757</td>
<td>2025-09-10</td>
<td>511.88</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>64</td>
<td>2025-01-08</td>
<td>717.88</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Order Value (Approx.): R$ 2083.08</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RecomendationSystemEN_files/figure-html/cell-15-output-4.png" width="825" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="customer-product-matrix-density-sparsity" class="level5">
<h5 data-anchor-id="customer-product-matrix-density-sparsity">Customer × product matrix — density (SPARSITY)</h5>
<div id="0eab17bb" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT (SELECT COUNT(DISTINCT customer_id) FROM transactions) AS n_customers_active,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">       (SELECT COUNT(DISTINCT product_id) FROM transactions) AS n_products_sold,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">       (SELECT COUNT(*) FROM transactions) AS n_transactions;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>df_dim <span class="op">=</span> run_sql_pure(sql)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>n_customers <span class="op">=</span> <span class="bu">int</span>(df_dim[<span class="st">'n_customers_active'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>n_products <span class="op">=</span> <span class="bu">int</span>(df_dim[<span class="st">'n_products_sold'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>n_trans <span class="op">=</span> <span class="bu">int</span>(df_dim[<span class="st">'n_transactions'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>possible <span class="op">=</span> n_customers <span class="op">*</span> n_products</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>sparsity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n_trans <span class="op">/</span> possible)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"customer: </span><span class="sc">{</span>n_customers<span class="sc">}</span><span class="ss">, Products: </span><span class="sc">{</span>n_products<span class="sc">}</span><span class="ss">, Transactions: </span><span class="sc">{</span>n_trans<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sparsity (aprox): </span><span class="sc">{</span>sparsity<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---- Executing SQL ----
SELECT (SELECT COUNT(DISTINCT customer_id) FROM transactions) AS n_customers_active,
       (SELECT COUNT(DISTINCT product_id) FROM transactions) AS n_products_sold,
       (SELECT COUNT(*) FROM transactions) AS n_transactions;
-----------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_customers_active</th>
<th data-quarto-table-cell-role="th">n_products_sold</th>
<th data-quarto-table-cell-role="th">n_transactions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1000</td>
<td>300</td>
<td>21123</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>customer: 1000, Products: 300, Transactions: 21123
Sparsity (aprox): 0.929590</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="key-insights-from-eda" class="level2">
<h2 data-anchor-id="key-insights-from-eda">Key Insights from EDA</h2>
<p>The analysis reveals important patterns:</p>
<ul>
<li>high concentration of sales in a few categories,</li>
<li>customers with relatively high purchase frequency,</li>
<li>high sparsity (&gt;90%) in the interaction matrix.</li>
</ul>
<p>These findings justify the choice of:</p>
<ul>
<li>item-based models instead of user-based,</li>
<li>a hybrid approach to mitigate individual model limitations.</li>
</ul>
<hr>
</section>
</section>
<section id="algorithm-development" class="level1">
<h1>Algorithm Development</h1>
<p>Based on the EDA, a hybrid architecture was defined where each component addresses a specific problem:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Role</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Item-Item CF</td>
<td>Behavior-based personalization</td>
</tr>
<tr class="even">
<td>Content-Based</td>
<td>Semantic similarity and cold start</td>
</tr>
<tr class="odd">
<td>Association Rules</td>
<td>Contextual cross-sell</td>
</tr>
</tbody>
</table>
<p>The goal is not to replace models, but to <strong>combine complementary signals</strong>.</p>
<section id="item-item-collaborative-filtering" class="level2">
<h2 data-anchor-id="item-item-collaborative-filtering">Item-Item Collaborative Filtering</h2>
<p>At this stage, we build a recommender system based exclusively on historical purchase patterns. Item-Item CF recommends items similar to those already purchased by the user, measuring similarity between items based on user behavior (users who bought A also bought B).</p>
<section id="create-the-interaction-dataset-customer-product" class="level5">
<h5 data-anchor-id="create-the-interaction-dataset-customer-product">Create the interaction dataset (customer × product):</h5>
<div id="b1f7235f" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>interactions <span class="op">=</span> (</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    transactions[[<span class="st">'customer_id'</span>, <span class="st">'product_id'</span>]]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .drop_duplicates()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>interactions[<span class="st">'interaction'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>interactions.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">interaction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>847</td>
<td>207</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>61</td>
<td>295</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>61</td>
<td>265</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>859</td>
<td>93</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>859</td>
<td>256</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="build-the-item-customer-matrix" class="level5">
<h5 data-anchor-id="build-the-item-customer-matrix">Build the Item × Customer matrix:</h5>
<div id="8b1e3f8a" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>item_user_matrix <span class="op">=</span> interactions.pivot_table(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'product_id'</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'customer_id'</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'interaction'</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    fill_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>item_user_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>(300, 1000)</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="check-sparsity" class="level5">
<h5 data-anchor-id="check-sparsity">Check sparsity:</h5>
<div id="000f69f3" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>density <span class="op">=</span> item_user_matrix.values.<span class="bu">sum</span>() <span class="op">/</span> item_user_matrix.size</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sparsity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> density</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sparsity: </span><span class="sc">{</span>sparsity<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sparsity: 0.9333</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="compute-item-item-similarity-cosine" class="level5">
<h5 data-anchor-id="compute-item-item-similarity-cosine">Compute Item-Item similarity (Cosine):</h5>
<div id="e5c58431" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>item_similarity <span class="op">=</span> cosine_similarity(item_user_matrix)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>item_sim_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    item_similarity,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>item_user_matrix.index,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>item_user_matrix.index</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>item_sim_df.iloc[:<span class="dv">5</span>, :<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="130">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1.000000</td>
<td>0.053995</td>
<td>0.096540</td>
<td>0.066172</td>
<td>0.054554</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.053995</td>
<td>1.000000</td>
<td>0.068416</td>
<td>0.112548</td>
<td>0.041239</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.096540</td>
<td>0.068416</td>
<td>1.000000</td>
<td>0.088038</td>
<td>0.082950</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.066172</td>
<td>0.112548</td>
<td>0.088038</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.054554</td>
<td>0.041239</td>
<td>0.082950</td>
<td>0.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="co-occurrence" class="level5">
<h5 data-anchor-id="co-occurrence">Co-occurrence</h5>
<div id="4d0eb7a0" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>cooccurrence <span class="op">=</span> item_user_matrix <span class="op">@</span> item_user_matrix.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="shrinkage" class="level5">
<h5 data-anchor-id="shrinkage">Shrinkage</h5>
<div id="cf109fad" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>LAMBDA <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>shrunk_similarity <span class="op">=</span> item_sim_df <span class="op">*</span> (cooccurrence <span class="op">/</span> (cooccurrence <span class="op">+</span> LAMBDA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="recommendation-function-item-item-cf" class="level5">
<h5 data-anchor-id="recommendation-function-item-item-cf">Recommendation function (Item-Item CF)</h5>
<div id="89f733fa" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Função de Recomendação (Item-Item CF)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_item_item(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Produtos comprados pelo usuário</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> interactions.loc[</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        interactions[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Score médio de similaridade</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> shrunk_similarity.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remover itens já comprados</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scores.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="model-testing" class="level5">
<h5 data-anchor-id="model-testing">Model testing</h5>
<div id="1e4e7830" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>test_user <span class="op">=</span> interactions[<span class="st">'customer_id'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>recommend_item_item(test_user, k<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>product_id
226    0.049454
115    0.049118
240    0.048700
177    0.048648
251    0.048641
dtype: float64</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="enrich-recommendations-with-product-information" class="level5">
<h5 data-anchor-id="enrich-recommendations-with-product-information">Enrich recommendations with product information</h5>
<div id="503eb9af" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_with_metadata(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    recs <span class="op">=</span> recommend_item_item(user_id, k)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        recs</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        .merge(products, on<span class="op">=</span><span class="st">'product_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'score'</span>})</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>recommend_with_metadata(test_user, k<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="135">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">is_active</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>226</td>
<td>0.049454</td>
<td>Casa Tramontina Aliquam</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1060.30</td>
<td>2025-04-24 19:35:33</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>115</td>
<td>0.049118</td>
<td>Casa Brastemp Consequuntur</td>
<td>Casa</td>
<td>Brastemp</td>
<td>1209.33</td>
<td>2025-09-24 12:32:13</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>240</td>
<td>0.048700</td>
<td>Casa Tramontina Non</td>
<td>Casa</td>
<td>Tramontina</td>
<td>266.60</td>
<td>2025-04-09 07:52:33</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>177</td>
<td>0.048648</td>
<td>Acessórios Oakley Quo</td>
<td>Acessórios</td>
<td>Oakley</td>
<td>1137.78</td>
<td>2025-06-19 00:19:11</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>251</td>
<td>0.048641</td>
<td>Acessórios Oakley Eos</td>
<td>Acessórios</td>
<td>Oakley</td>
<td>861.36</td>
<td>2025-10-01 13:00:22</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>The Item-Item Collaborative Filtering model identifies similar products based on real purchase patterns, enabling scalable and personalized recommendations. The application of shrinkage reduces noise caused by rare co-occurrences, making the system more reliable in high-sparsity scenarios typical of e-commerce.</p>
<p>The score generated by the Item-Item CF represents a relative affinity measure between products, based exclusively on historical purchase patterns. It is used to rank recommended items and should not be interpreted as an absolute probability.</p>
<hr>
</section>
</section>
<section id="content-based-filtering-tf-idf" class="level2">
<h2 data-anchor-id="content-based-filtering-tf-idf">Content-Based Filtering (TF-IDF)</h2>
<p>Despite the strength of behavioral signals, CF presents limitations:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Limitation</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Product cold start</td>
<td>New products are never recommended</td>
</tr>
<tr class="even">
<td>Historical dependency</td>
<td>Limited semantic explanation</td>
</tr>
<tr class="odd">
<td>High sparsity</td>
<td>Some items rarely appear</td>
</tr>
</tbody>
</table>
<p>To mitigate these issues, Content-Based Filtering is used by representing products through their textual attributes.</p>
<section id="product-text-preparation" class="level5">
<h5 data-anchor-id="product-text-preparation">Product text preparation:</h5>
<div id="e9f9a9f1" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>products_cb <span class="op">=</span> products.copy()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>products_cb[<span class="st">'text'</span>] <span class="op">=</span> (</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    products_cb[<span class="st">'name'</span>].fillna(<span class="st">''</span>) <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    products_cb[<span class="st">'category'</span>].fillna(<span class="st">''</span>) <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    products_cb[<span class="st">'brand'</span>].fillna(<span class="st">''</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>products_cb[[<span class="st">'product_id'</span>, <span class="st">'text'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="136">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Eletrônicos LG Repellendus Eletrônicos LG</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>Roupas Puma Ad Roupas Puma</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>Acessórios Apple Assumenda Acessórios Apple</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>Eletrônicos Apple Fugit Eletrônicos Apple</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>Calçados Adidas Nisi Calçados Adidas</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="tf-idf-vectorization" class="level5">
<h5 data-anchor-id="tf-idf-vectorization">TF-IDF vectorization:</h5>
<div id="53da3597" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    min_df<span class="op">=</span><span class="dv">2</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>tfidf_matrix <span class="op">=</span> tfidf.fit_transform(products_cb[<span class="st">'text'</span>])</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>tfidf_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="137">
<pre><code>(300, 178)</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="product-similarity-cosine" class="level5">
<h5 data-anchor-id="product-similarity-cosine">Product similarity (Cosine):</h5>
<div id="5d620fc0" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>content_similarity <span class="op">=</span> cosine_similarity(tfidf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="build-the-product-product-matrix" class="level5">
<h5 data-anchor-id="build-the-product-product-matrix">Build the Product × Product matrix:</h5>
<div id="2685decf" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>content_sim_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    content_similarity,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>products_cb[<span class="st">'product_id'</span>],</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>products_cb[<span class="st">'product_id'</span>]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>content_sim_df.iloc[:<span class="dv">5</span>, :<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="139">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.171325</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.000000</td>
<td>1.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.000000</td>
<td>0.0</td>
<td>1.000000</td>
<td>0.279115</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.171325</td>
<td>0.0</td>
<td>0.279115</td>
<td>1.000000</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="content-based-recommendation-function" class="level5">
<h5 data-anchor-id="content-based-recommendation-function">Content-Based recommendation function:</h5>
<div id="62e89276" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_content_based(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> interactions.loc[</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>        interactions[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> content_sim_df.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scores.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="content-based-model-testing" class="level5">
<h5 data-anchor-id="content-based-model-testing">Content-Based model testing:</h5>
<div id="7cc2a7e1" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>test_user <span class="op">=</span> interactions[<span class="st">'customer_id'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>recommend_content_based(test_user, k<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="141">
<pre><code>product_id
273    0.261552
48     0.261552
236    0.261552
153    0.261552
198    0.238911
dtype: float64</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="enrich-recommendations-with-product-information-1" class="level5">
<h5 data-anchor-id="enrich-recommendations-with-product-information-1">Enrich recommendations with product information:</h5>
<div id="c9c4aceb" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_cb_with_metadata(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    recs <span class="op">=</span> recommend_content_based(user_id, k)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>        recs</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        .merge(products, on<span class="op">=</span><span class="st">'product_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">'score'</span>})</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>recommend_cb_with_metadata(test_user, k<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="142">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">is_active</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>273</td>
<td>0.261552</td>
<td>Casa Tramontina Qui</td>
<td>Casa</td>
<td>Tramontina</td>
<td>685.94</td>
<td>2025-04-16 05:18:13</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>48</td>
<td>0.261552</td>
<td>Casa Tramontina Hic</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1421.98</td>
<td>2025-02-23 00:01:48</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>236</td>
<td>0.261552</td>
<td>Casa Tramontina Facilis</td>
<td>Casa</td>
<td>Tramontina</td>
<td>211.16</td>
<td>2025-10-03 22:08:43</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>153</td>
<td>0.261552</td>
<td>Casa Tramontina Praesentium</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1446.87</td>
<td>2025-06-09 04:19:16</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>198</td>
<td>0.238911</td>
<td>Casa Tramontina Quae</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1185.80</td>
<td>2025-11-15 18:44:03</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>The content-based model recommends semantically similar products, increasing system coverage and enabling recommendations even for items with limited historical data.</p>
<hr>
</section>
</section>
<section id="offline-evaluation-cf-vs-cb" class="level2">
<h2 data-anchor-id="offline-evaluation-cf-vs-cb">Offline Evaluation — CF vs CB</h2>
<p>Before combining the models into a hybrid approach, Item-Item Collaborative Filtering (CF) and Content-Based Filtering (CB) were evaluated separately. This step is required to understand the individual contribution of each signal, identify their strengths and limitations, and prevent a dominant but noisy model from degrading overall performance.</p>
<p>Isolated evaluation allows comparison using ranking metrics, informed tuning of hybrid model weights, and technical justification of the chosen architecture. In e-commerce scenarios, this practice ensures that the hybrid model delivers incremental gains over individual baselines rather than merely combining signals without measurable benefit.</p>
<section id="create-a-leave-last-out-temporal-split-for-evaluation" class="level5">
<h5 data-anchor-id="create-a-leave-last-out-temporal-split-for-evaluation">Create a Leave-Last-Out temporal split for evaluation:</h5>
<div id="2492652f" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>interactions_eval <span class="op">=</span> transactions[[<span class="st">'customer_id'</span>, <span class="st">'product_id'</span>, <span class="st">'transaction_date'</span>]].copy()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir tipo datetime</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>interactions_eval[<span class="st">'transaction_date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    interactions_eval[<span class="st">'transaction_date'</span>]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar temporalmente</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>interactions_eval <span class="op">=</span> interactions_eval.sort_values(</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'customer_id'</span>, <span class="st">'transaction_date'</span>, <span class="st">'product_id'</span>]</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializar estruturas</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>train_interactions <span class="op">=</span> []</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>test_interactions <span class="op">=</span> {}</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Holdout temporal (Last Item)</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> user_id, group <span class="kw">in</span> interactions_eval.groupby(<span class="st">'customer_id'</span>):</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> group[<span class="st">'product_id'</span>].tolist()</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(items) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    test_item <span class="op">=</span> items[<span class="op">-</span><span class="dv">1</span>]  <span class="co"># último item (mais recente)</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    test_interactions[user_id] <span class="op">=</span> test_item</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> items[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>        train_interactions.append((user_id, item))</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    train_interactions,</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'customer_id'</span>, <span class="st">'product_id'</span>]</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">'interaction'</span>] <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="rebuild-the-item-user-matrix-for-training" class="level5">
<h5 data-anchor-id="rebuild-the-item-user-matrix-for-training">Rebuild the Item × User matrix for training:</h5>
<div id="ef282603" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>item_user_train <span class="op">=</span> train_df.pivot_table(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'product_id'</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'customer_id'</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'interaction'</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    fill_value<span class="op">=</span><span class="dv">0</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="recompute-cf-on-the-training-set" class="level4">
<h4 data-anchor-id="recompute-cf-on-the-training-set">Recompute CF on the training set:</h4>
<div id="fba12dda" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>item_sim_train <span class="op">=</span> cosine_similarity(item_user_train)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>item_sim_train_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    item_sim_train,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>item_user_train.index,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>item_user_train.index</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<section id="recommendation-function-for-evaluation-cf" class="level5">
<h5 data-anchor-id="recommendation-function-for-evaluation-cf">Recommendation function for evaluation (CF):</h5>
<div id="494aabfc" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_cf_eval(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> train_df.loc[</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> item_sim_train_df.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scores.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k).index.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="recommendation-function-for-evaluation-cb" class="level5">
<h5 data-anchor-id="recommendation-function-for-evaluation-cb">Recommendation function for evaluation (CB):</h5>
<div id="2ee4ea1d" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_cb_eval(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> train_df.loc[</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> content_sim_df.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> scores.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k).index.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="evaluate-hit-rate-k" class="level5">
<h5 data-anchor-id="evaluate-hit-rate-k">Evaluate Hit Rate @ K:</h5>
<div id="7940ff2c" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hit_rate(model_func, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    hits <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> user_id <span class="kw">in</span> <span class="bu">sorted</span>(test_interactions.keys()):</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        true_item <span class="op">=</span> test_interactions[user_id]</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        recs <span class="op">=</span> model_func(user_id, k)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> true_item <span class="kw">in</span> recs:</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>            hits <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hits <span class="op">/</span> total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="results-cf-vs-cb" class="level5">
<h5 data-anchor-id="results-cf-vs-cb">Results — CF vs CB:</h5>
<div id="3559418d" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">5</span>, <span class="dv">10</span>]:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    hr_cf <span class="op">=</span> hit_rate(recommend_cf_eval, k)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    hr_cb <span class="op">=</span> hit_rate(recommend_cb_eval, k)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Hit Rate @ </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Item-Item CF: </span><span class="sc">{</span>hr_cf<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Content-Based: </span><span class="sc">{</span>hr_cb<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Hit Rate @ 5
  Item-Item CF: 0.0260
  Content-Based: 0.0290
------------------------------
Hit Rate @ 10
  Item-Item CF: 0.0500
  Content-Based: 0.0610
------------------------------</code></pre>
</div>
</div>
<p><br></p>
<p>Before building the hybrid model, we evaluated the performance of Item-Item Collaborative Filtering and Content-Based Filtering separately using a Leave-One-Out strategy and the Hit Rate@K metric.</p>
<p>The results indicate that the collaborative model exhibits stronger predictive capability, reflecting the strength of behavioral signals in implicit feedback data. Although the Content-Based model shows lower standalone performance, it remains consistent and suitable for complementing the system, particularly in cold start scenarios and for improving coverage.</p>
<p><em>Conclusion:</em> CF achieves better standalone performance, while CB provides incremental value — justifying their combination.</p>
</section>
</section>
</section>
<section id="hybrid-model-weight-tuning" class="level2">
<h2 data-anchor-id="hybrid-model-weight-tuning">Hybrid Model — Weight Tuning</h2>
<p>At this stage, we test different weight combinations between CF and CB to maximize performance.</p>
<section id="we-test-the-following-configurations" class="level4">
<h4 data-anchor-id="we-test-the-following-configurations">We test the following configurations::</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>w_cf</th>
<th>w_cb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>0.2</td>
<td>0.8</td>
</tr>
<tr class="odd">
<td>0.4</td>
<td>0.6</td>
</tr>
<tr class="even">
<td>0.6</td>
<td>0.4</td>
</tr>
<tr class="odd">
<td>0.8</td>
<td>0.2</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<p>Isso inclui: <br> * pure CB * pure CF * intermediate hybrid configurations</p>
<section id="utility-normalization-function" class="level5">
<h5 data-anchor-id="utility-normalization-function">Utility normalization function:</h5>
<div id="f216dbe3" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_max_normalize(scores: pd.Series):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scores.empty:</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scores</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (scores <span class="op">-</span> scores.<span class="bu">min</span>()) <span class="op">/</span> (scores.<span class="bu">max</span>() <span class="op">-</span> scores.<span class="bu">min</span>() <span class="op">+</span> <span class="fl">1e-9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="hybrid-recommendation-function" class="level5">
<h5 data-anchor-id="hybrid-recommendation-function">Hybrid recommendation function:</h5>
<div id="25b303f7" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_hybrid_eval(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    user_id,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    k<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    w_cf<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    w_cb<span class="op">=</span><span class="fl">0.4</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> train_df.loc[</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        train_df[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CF</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    scores_cf <span class="op">=</span> item_sim_train_df.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    scores_cf <span class="op">=</span> scores_cf.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    scores_cf <span class="op">=</span> min_max_normalize(scores_cf)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CB</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    scores_cb <span class="op">=</span> content_sim_df.loc[bought_items].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    scores_cb <span class="op">=</span> scores_cb.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    scores_cb <span class="op">=</span> min_max_normalize(scores_cb)</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combinação</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    hybrid_scores <span class="op">=</span> (</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        w_cf <span class="op">*</span> scores_cf <span class="op">+</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>        w_cb <span class="op">*</span> scores_cb</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    ).dropna()</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hybrid_scores.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="hybrid-evaluation-function" class="level5">
<h5 data-anchor-id="hybrid-evaluation-function">Hybrid evaluation function:</h5>
<div id="de78c82d" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_hybrid(weights, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ordem fixa de usuários</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    users <span class="op">=</span> <span class="bu">sorted</span>(test_interactions.keys())</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> w_cf, w_cb <span class="kw">in</span> weights:</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        hits <span class="op">=</span> []</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> user <span class="kw">in</span> users:</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>            true_item <span class="op">=</span> test_interactions[user]</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>            recs <span class="op">=</span> recommend_hybrid_eval(</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>                user_id<span class="op">=</span>user,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>                k<span class="op">=</span>k,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>                w_cf<span class="op">=</span>w_cf,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>                w_cb<span class="op">=</span>w_cb</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>            hits.append(<span class="bu">int</span>(true_item <span class="kw">in</span> recs.index))</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'w_cf'</span>: w_cf,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'w_cb'</span>: w_cb,</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'hit_rate@</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">'</span>: np.mean(hits)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="run-weight-tuning" class="level5">
<h5 data-anchor-id="run-weight-tuning">Run weight tuning:</h5>
<div id="c5b83afd" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>weight_grid <span class="op">=</span> [</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">0.0</span>, <span class="fl">1.0</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">0.2</span>, <span class="fl">0.8</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">0.4</span>, <span class="fl">0.6</span>),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">0.6</span>, <span class="fl">0.4</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">0.8</span>, <span class="fl">0.2</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">1.0</span>, <span class="fl">0.0</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>df_hybrid_eval <span class="op">=</span> evaluate_hybrid(weight_grid, k<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>df_hybrid_eval.sort_values(<span class="st">'hit_rate@10'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="153">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">w_cf</th>
<th data-quarto-table-cell-role="th">w_cb</th>
<th data-quarto-table-cell-role="th">hit_rate@10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.6</td>
<td>0.4</td>
<td>0.068</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.4</td>
<td>0.6</td>
<td>0.064</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.8</td>
<td>0.2</td>
<td>0.060</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.2</td>
<td>0.8</td>
<td>0.059</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1.0</td>
<td>0.0</td>
<td>0.050</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>The combination of collaborative and content-based models resulted in improved performance. The best result was obtained with weights w_cf=0.6 and w_cb=0.4, indicating that behavioral signals should be predominant while being complemented by semantic similarity.</p>
<p>These results confirm that the hybrid model captures multiple dimensions of user behavior, reduces the individual limitations of the base models, and provides a more robust trade-off between precision and coverage.</p>
</section>
</section>
</section>
<section id="association-rules-apriori" class="level2">
<h2 data-anchor-id="association-rules-apriori">Association Rules (Apriori)</h2>
<p>In addition to collaborative and content-based approaches, the system incorporates Association Rules to capture explicit co-occurrence patterns in shopping baskets. This technique enables the identification of products frequently purchased together and is particularly effective for cross-sell strategies and increasing average order value.</p>
<p>Unlike user-centric models, association rules operate directly on transactions, making them robust to user cold start scenarios and highly interpretable for business stakeholders. When integrated into the hybrid model, these rules complement personalization with recommendations of complementary products.</p>
<p>Simple analogy <br></p>
<ul>
<li>CF = suggest a similar shirt</li>
<li>CB = suggest a shirt from the same brand <br> Association Rules = suggest the belt that usually goes with the shirt</li>
</ul>
<p>In other words, answering the question: What is usually bought together?</p>
<section id="build-shopping-baskets" class="level5">
<h5 data-anchor-id="build-shopping-baskets">Build shopping baskets:</h5>
<div id="aa93e64f" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir que a coluna 'transaction_date' seja do tipo datetime</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>transactions[<span class="st">'transaction_date'</span>] <span class="op">=</span> pd.to_datetime(transactions[<span class="st">'transaction_date'</span>])</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar uma coluna de "order_id"</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>transactions[<span class="st">'order_id'</span>] <span class="op">=</span> (</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    transactions[<span class="st">'customer_id'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    transactions[<span class="st">'transaction_date'</span>].dt.date.astype(<span class="bu">str</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar produtos por pedido</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>basket <span class="op">=</span> (</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    transactions</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'order_id'</span>)[<span class="st">'product_id'</span>]</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="bu">list</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>basket.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="154">
<pre><code>order_id
1000_2025-01-28    [5, 3, 179]
1000_2025-04-01       [50, 82]
1000_2025-04-07      [142, 97]
1000_2025-07-21          [234]
1000_2025-08-09          [296]
Name: product_id, dtype: object</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="one-hot-encoding-of-baskets" class="level5">
<h5 data-anchor-id="one-hot-encoding-of-baskets">One-hot encoding of baskets:</h5>
<div id="c2e2cb30" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>te <span class="op">=</span> TransactionEncoder()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>te_array <span class="op">=</span> te.fit(basket).transform(basket)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>basket_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    te_array,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>te.columns_</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>basket_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="155">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">291</th>
<th data-quarto-table-cell-role="th">292</th>
<th data-quarto-table-cell-role="th">293</th>
<th data-quarto-table-cell-role="th">294</th>
<th data-quarto-table-cell-role="th">295</th>
<th data-quarto-table-cell-role="th">296</th>
<th data-quarto-table-cell-role="th">297</th>
<th data-quarto-table-cell-role="th">298</th>
<th data-quarto-table-cell-role="th">299</th>
<th data-quarto-table-cell-role="th">300</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>5 rows × 300 columns</p>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="loop-by-category" class="level5">
<h5 data-anchor-id="loop-by-category">Loop by category:</h5>
<div id="9d3263ac" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop por categoria</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>rules_all <span class="op">=</span> []</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> products[<span class="st">'category'</span>].unique():</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    products_cat <span class="op">=</span> products.loc[</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        products[<span class="st">'category'</span>] <span class="op">==</span> category, <span class="st">'product_id'</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    ].tolist()</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    basket_cat <span class="op">=</span> basket.<span class="bu">apply</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> items: [i <span class="cf">for</span> i <span class="kw">in</span> items <span class="cf">if</span> i <span class="kw">in</span> products_cat]</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    basket_cat <span class="op">=</span> basket_cat[basket_cat.<span class="bu">apply</span>(<span class="bu">len</span>) <span class="op">&gt;=</span> <span class="dv">2</span>]</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(basket_cat) <span class="op">&lt;</span> <span class="dv">50</span>:</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    te <span class="op">=</span> TransactionEncoder()</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    te_array <span class="op">=</span> te.fit(basket_cat).transform(basket_cat)</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    basket_df_cat <span class="op">=</span> pd.DataFrame(</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>        te_array,</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>te.columns_</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    frequent_itemsets <span class="op">=</span> apriori(</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>        basket_df_cat,</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>        min_support<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>        use_colnames<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>        max_len<span class="op">=</span><span class="dv">2</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> frequent_itemsets.empty:</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    rules <span class="op">=</span> association_rules(</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>        frequent_itemsets,</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>        metric<span class="op">=</span><span class="st">'lift'</span>,</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>        min_threshold<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rules.empty:</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>    rules[<span class="st">'category'</span>] <span class="op">=</span> category</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>    rules_all.append(rules)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="consolidate-all-rules" class="level5">
<h5 data-anchor-id="consolidate-all-rules">Consolidate all rules:</h5>
<div id="95eac9a7" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>rules_df <span class="op">=</span> pd.concat(rules_all, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>rules_df.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="157">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">antecedents</th>
<th data-quarto-table-cell-role="th">consequents</th>
<th data-quarto-table-cell-role="th">antecedent support</th>
<th data-quarto-table-cell-role="th">consequent support</th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">lift</th>
<th data-quarto-table-cell-role="th">representativity</th>
<th data-quarto-table-cell-role="th">leverage</th>
<th data-quarto-table-cell-role="th">conviction</th>
<th data-quarto-table-cell-role="th">zhangs_metric</th>
<th data-quarto-table-cell-role="th">jaccard</th>
<th data-quarto-table-cell-role="th">certainty</th>
<th data-quarto-table-cell-role="th">kulczynski</th>
<th data-quarto-table-cell-role="th">category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>(215)</td>
<td>(269)</td>
<td>0.035176</td>
<td>0.035176</td>
<td>0.010050</td>
<td>0.285714</td>
<td>8.122449</td>
<td>1.0</td>
<td>0.008813</td>
<td>1.350754</td>
<td>0.908854</td>
<td>0.166667</td>
<td>0.259673</td>
<td>0.285714</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>(269)</td>
<td>(215)</td>
<td>0.035176</td>
<td>0.035176</td>
<td>0.010050</td>
<td>0.285714</td>
<td>8.122449</td>
<td>1.0</td>
<td>0.008813</td>
<td>1.350754</td>
<td>0.908854</td>
<td>0.166667</td>
<td>0.259673</td>
<td>0.285714</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>(187)</td>
<td>(163)</td>
<td>0.055276</td>
<td>0.025126</td>
<td>0.010050</td>
<td>0.181818</td>
<td>7.236364</td>
<td>1.0</td>
<td>0.008661</td>
<td>1.191513</td>
<td>0.912234</td>
<td>0.142857</td>
<td>0.160731</td>
<td>0.290909</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>(163)</td>
<td>(187)</td>
<td>0.025126</td>
<td>0.055276</td>
<td>0.010050</td>
<td>0.400000</td>
<td>7.236364</td>
<td>1.0</td>
<td>0.008661</td>
<td>1.574539</td>
<td>0.884021</td>
<td>0.142857</td>
<td>0.364894</td>
<td>0.290909</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(288)</td>
<td>(110)</td>
<td>0.040201</td>
<td>0.040201</td>
<td>0.010050</td>
<td>0.250000</td>
<td>6.218750</td>
<td>1.0</td>
<td>0.008434</td>
<td>1.279732</td>
<td>0.874346</td>
<td>0.142857</td>
<td>0.218586</td>
<td>0.250000</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>(110)</td>
<td>(288)</td>
<td>0.040201</td>
<td>0.040201</td>
<td>0.010050</td>
<td>0.250000</td>
<td>6.218750</td>
<td>1.0</td>
<td>0.008434</td>
<td>1.279732</td>
<td>0.874346</td>
<td>0.142857</td>
<td>0.218586</td>
<td>0.250000</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>(241)</td>
<td>(176)</td>
<td>0.050251</td>
<td>0.045226</td>
<td>0.010050</td>
<td>0.200000</td>
<td>4.422222</td>
<td>1.0</td>
<td>0.007778</td>
<td>1.193467</td>
<td>0.814815</td>
<td>0.117647</td>
<td>0.162105</td>
<td>0.211111</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>(176)</td>
<td>(241)</td>
<td>0.045226</td>
<td>0.050251</td>
<td>0.010050</td>
<td>0.222222</td>
<td>4.422222</td>
<td>1.0</td>
<td>0.007778</td>
<td>1.221106</td>
<td>0.810526</td>
<td>0.117647</td>
<td>0.181070</td>
<td>0.211111</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(67)</td>
<td>(275)</td>
<td>0.053398</td>
<td>0.063107</td>
<td>0.014563</td>
<td>0.272727</td>
<td>4.321678</td>
<td>1.0</td>
<td>0.011193</td>
<td>1.288228</td>
<td>0.811966</td>
<td>0.142857</td>
<td>0.223740</td>
<td>0.251748</td>
<td>Eletrônicos</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(275)</td>
<td>(67)</td>
<td>0.063107</td>
<td>0.053398</td>
<td>0.014563</td>
<td>0.230769</td>
<td>4.321678</td>
<td>1.0</td>
<td>0.011193</td>
<td>1.230583</td>
<td>0.820380</td>
<td>0.142857</td>
<td>0.187377</td>
<td>0.251748</td>
<td>Eletrônicos</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="filter-rules" class="level5">
<h5 data-anchor-id="filter-rules">Filter rules:</h5>
<div id="deaf22a6" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>rules_filtered <span class="op">=</span> rules_df[</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    (rules_df[<span class="st">'antecedents'</span>].<span class="bu">apply</span>(<span class="bu">len</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    (rules_df[<span class="st">'consequents'</span>].<span class="bu">apply</span>(<span class="bu">len</span>) <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    (rules_df[<span class="st">'confidence'</span>] <span class="op">&gt;=</span> <span class="fl">0.2</span>) <span class="op">&amp;</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    (rules_df[<span class="st">'lift'</span>] <span class="op">&gt;=</span> <span class="fl">1.2</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>].sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>rules_filtered.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="158">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">antecedents</th>
<th data-quarto-table-cell-role="th">consequents</th>
<th data-quarto-table-cell-role="th">antecedent support</th>
<th data-quarto-table-cell-role="th">consequent support</th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">lift</th>
<th data-quarto-table-cell-role="th">representativity</th>
<th data-quarto-table-cell-role="th">leverage</th>
<th data-quarto-table-cell-role="th">conviction</th>
<th data-quarto-table-cell-role="th">zhangs_metric</th>
<th data-quarto-table-cell-role="th">jaccard</th>
<th data-quarto-table-cell-role="th">certainty</th>
<th data-quarto-table-cell-role="th">kulczynski</th>
<th data-quarto-table-cell-role="th">category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>(269)</td>
<td>(215)</td>
<td>0.035176</td>
<td>0.035176</td>
<td>0.010050</td>
<td>0.285714</td>
<td>8.122449</td>
<td>1.0</td>
<td>0.008813</td>
<td>1.350754</td>
<td>0.908854</td>
<td>0.166667</td>
<td>0.259673</td>
<td>0.285714</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>(215)</td>
<td>(269)</td>
<td>0.035176</td>
<td>0.035176</td>
<td>0.010050</td>
<td>0.285714</td>
<td>8.122449</td>
<td>1.0</td>
<td>0.008813</td>
<td>1.350754</td>
<td>0.908854</td>
<td>0.166667</td>
<td>0.259673</td>
<td>0.285714</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>(163)</td>
<td>(187)</td>
<td>0.025126</td>
<td>0.055276</td>
<td>0.010050</td>
<td>0.400000</td>
<td>7.236364</td>
<td>1.0</td>
<td>0.008661</td>
<td>1.574539</td>
<td>0.884021</td>
<td>0.142857</td>
<td>0.364894</td>
<td>0.290909</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>(110)</td>
<td>(288)</td>
<td>0.040201</td>
<td>0.040201</td>
<td>0.010050</td>
<td>0.250000</td>
<td>6.218750</td>
<td>1.0</td>
<td>0.008434</td>
<td>1.279732</td>
<td>0.874346</td>
<td>0.142857</td>
<td>0.218586</td>
<td>0.250000</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(288)</td>
<td>(110)</td>
<td>0.040201</td>
<td>0.040201</td>
<td>0.010050</td>
<td>0.250000</td>
<td>6.218750</td>
<td>1.0</td>
<td>0.008434</td>
<td>1.279732</td>
<td>0.874346</td>
<td>0.142857</td>
<td>0.218586</td>
<td>0.250000</td>
<td>Calçados</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>(176)</td>
<td>(241)</td>
<td>0.045226</td>
<td>0.050251</td>
<td>0.010050</td>
<td>0.222222</td>
<td>4.422222</td>
<td>1.0</td>
<td>0.007778</td>
<td>1.221106</td>
<td>0.810526</td>
<td>0.117647</td>
<td>0.181070</td>
<td>0.211111</td>
<td>Calçados</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(67)</td>
<td>(275)</td>
<td>0.053398</td>
<td>0.063107</td>
<td>0.014563</td>
<td>0.272727</td>
<td>4.321678</td>
<td>1.0</td>
<td>0.011193</td>
<td>1.288228</td>
<td>0.811966</td>
<td>0.142857</td>
<td>0.223740</td>
<td>0.251748</td>
<td>Eletrônicos</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(275)</td>
<td>(67)</td>
<td>0.063107</td>
<td>0.053398</td>
<td>0.014563</td>
<td>0.230769</td>
<td>4.321678</td>
<td>1.0</td>
<td>0.011193</td>
<td>1.230583</td>
<td>0.820380</td>
<td>0.142857</td>
<td>0.187377</td>
<td>0.251748</td>
<td>Eletrônicos</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
</section>
<section id="recommendation-function-association-rules-by-category" class="level5">
<h5 data-anchor-id="recommendation-function-association-rules-by-category">Recommendation function — Association Rules by category:</h5>
<div id="bb888d4b" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_association_by_category(user_id, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> interactions.loc[</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        interactions[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(bought_items) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    recs <span class="op">=</span> []</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> bought_items:</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>        item_category <span class="op">=</span> products.loc[</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>            products[<span class="st">'product_id'</span>] <span class="op">==</span> item, <span class="st">'category'</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        ].values[<span class="dv">0</span>]</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        matched_rules <span class="op">=</span> rules_filtered[</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>            (rules_filtered[<span class="st">'category'</span>] <span class="op">==</span> item_category) <span class="op">&amp;</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>            (rules_filtered[<span class="st">'antecedents'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: item <span class="kw">in</span> x))</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> matched_rules.iterrows():</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>            consequent <span class="op">=</span> <span class="bu">list</span>(row[<span class="st">'consequents'</span>])[<span class="dv">0</span>]</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>            recs.append((consequent, row[<span class="st">'lift'</span>]))</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> recs:</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    recs_df <span class="op">=</span> pd.DataFrame(recs, columns<span class="op">=</span>[<span class="st">'product_id'</span>, <span class="st">'score'</span>])</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>        recs_df</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>        .groupby(<span class="st">'product_id'</span>)[<span class="st">'score'</span>]</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">max</span>()</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>        .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>        .head(k)</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="testing" class="level5">
<h5 data-anchor-id="testing">Testing:</h5>
<div id="8120b5c8" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>user_items <span class="op">=</span> interactions.loc[</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    interactions[<span class="st">'customer_id'</span>] <span class="op">==</span> test_user, <span class="st">'product_id'</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>].unique()</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>user_items</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="160">
<pre><code>array([207, 228,  70,   1, 287,  32, 158, 144, 206, 224, 180,  12, 165,
        56,  74, 202,  65])</code></pre>
</div>
</div>
<p><br></p>
<p>Association rules were applied as a complementary cross-sell signal and are only used when the user’s purchase history intersects with the antecedents of the extracted rules.</p>
</section>
</section>
</section>
<section id="final-model" class="level1">
<h1>Final Model</h1>
<p>The final model combines:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Role in the system</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Item-Item CF</td>
<td>Behavior-based personalization</td>
</tr>
<tr class="even">
<td>Content-Based</td>
<td>Semantic similarity / cold start</td>
</tr>
<tr class="odd">
<td>Association Rules</td>
<td>Contextual cross-sell (checkout)</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>The hybrid model does not replace individual approaches — it combines signals.</p>
<p><strong>Note:</strong> Each model produces scores on different scales. Therefore, scores must be normalized before aggregation.</p>
<section id="utility-normalization-function-1" class="level5">
<h5 data-anchor-id="utility-normalization-function-1">Utility normalization function:</h5>
<div id="267db1e9" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_max_normalize(scores: pd.Series):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scores.empty:</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scores</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (scores <span class="op">-</span> scores.<span class="bu">min</span>()) <span class="op">/</span> (scores.<span class="bu">max</span>() <span class="op">-</span> scores.<span class="bu">min</span>() <span class="op">+</span> <span class="fl">1e-9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="hybrid-recommendation-function-1" class="level5">
<h5 data-anchor-id="hybrid-recommendation-function-1">Hybrid recommendation function:</h5>
<div id="bfa43206" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_hybrid(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    user_id,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    k<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    w_cf<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    w_cb<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    w_ar<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    scores_final <span class="op">=</span> pd.Series(dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------- CF ----------</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    scores_cf <span class="op">=</span> recommend_item_item(user_id, k<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    scores_cf <span class="op">=</span> min_max_normalize(scores_cf)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> scores_cf.empty:</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        scores_final <span class="op">=</span> scores_final.add(w_cf <span class="op">*</span> scores_cf, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------- Content-Based ----------</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    scores_cb <span class="op">=</span> recommend_content_based(user_id, k<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    scores_cb <span class="op">=</span> min_max_normalize(scores_cb)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> scores_cb.empty:</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        scores_final <span class="op">=</span> scores_final.add(w_cb <span class="op">*</span> scores_cb, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------- Association Rules ----------</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    scores_ar <span class="op">=</span> recommend_association_by_category(user_id, k<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    scores_ar <span class="op">=</span> min_max_normalize(scores_ar)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> scores_ar.empty:</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>        scores_final <span class="op">=</span> scores_final.add(w_ar <span class="op">*</span> scores_ar, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------- Remover itens já comprados ----------</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    bought_items <span class="op">=</span> interactions.loc[</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>        interactions[<span class="st">'customer_id'</span>] <span class="op">==</span> user_id, <span class="st">'product_id'</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>    ].unique()</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    scores_final <span class="op">=</span> scores_final.drop(bought_items, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> scores_final.sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section>
<section id="hybrid-model-testing" class="level5">
<h5 data-anchor-id="hybrid-model-testing">Hybrid model testing:</h5>
<div id="a206f9b4" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>test_user <span class="op">=</span> interactions[<span class="st">'customer_id'</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>recommend_hybrid(test_user, k<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="163">
<pre><code>product_id
226    0.699470
48     0.566488
240    0.557081
264    0.509695
115    0.486831
177    0.468447
251    0.468164
59     0.439393
189    0.405886
37     0.382290
dtype: float64</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="enrich-recommendations-with-metadata" class="level5">
<h5 data-anchor-id="enrich-recommendations-with-metadata">Enrich recommendations with metadata:</h5>
<div id="2dd95fc8" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_hybrid_with_metadata(user_id, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    recs <span class="op">=</span> recommend_hybrid(user_id, k)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        recs</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'product_id'</span>, <span class="dv">0</span>: <span class="st">'score'</span>})</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>        .merge(products, on<span class="op">=</span><span class="st">'product_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>recommend_hybrid_with_metadata(test_user, k<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="164">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">category</th>
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">is_active</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>226</td>
<td>0.699470</td>
<td>Casa Tramontina Aliquam</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1060.30</td>
<td>2025-04-24 19:35:33</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>48</td>
<td>0.566488</td>
<td>Casa Tramontina Hic</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1421.98</td>
<td>2025-02-23 00:01:48</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>240</td>
<td>0.557081</td>
<td>Casa Tramontina Non</td>
<td>Casa</td>
<td>Tramontina</td>
<td>266.60</td>
<td>2025-04-09 07:52:33</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>264</td>
<td>0.509695</td>
<td>Casa Tramontina Non</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1362.27</td>
<td>2025-12-03 22:31:56</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>115</td>
<td>0.486831</td>
<td>Casa Brastemp Consequuntur</td>
<td>Casa</td>
<td>Brastemp</td>
<td>1209.33</td>
<td>2025-09-24 12:32:13</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>177</td>
<td>0.468447</td>
<td>Acessórios Oakley Quo</td>
<td>Acessórios</td>
<td>Oakley</td>
<td>1137.78</td>
<td>2025-06-19 00:19:11</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>251</td>
<td>0.468164</td>
<td>Acessórios Oakley Eos</td>
<td>Acessórios</td>
<td>Oakley</td>
<td>861.36</td>
<td>2025-10-01 13:00:22</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>59</td>
<td>0.439393</td>
<td>Acessórios Samsung Debitis</td>
<td>Acessórios</td>
<td>Samsung</td>
<td>1481.17</td>
<td>2025-03-05 11:59:39</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>189</td>
<td>0.405886</td>
<td>Casa Tramontina Laboriosam</td>
<td>Casa</td>
<td>Tramontina</td>
<td>584.48</td>
<td>2025-09-10 03:56:53</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>37</td>
<td>0.382290</td>
<td>Casa Tramontina Tenetur</td>
<td>Casa</td>
<td>Tramontina</td>
<td>1352.54</td>
<td>2025-10-23 17:22:50</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>The final system combines three complementary signals: Item-Item Collaborative Filtering, Content-Based Filtering, and Association Rules. Each component addresses a distinct aspect of the problem, ensuring personalization, coverage, and cross-sell capability. Scores are normalized and combined through a weighted sum, allowing fine-grained control over the impact of each signal.</p>
<p>The model analyzes customer history, product similarity, and recurring co-purchase patterns to generate personalized and contextualized recommendations, balancing individual relevance with opportunities to increase average order value. In scenarios where no strong signal exists, the system avoids forcing artificial recommendations, preserving ranking quality.</p>
</section>
</section>
<section id="model-conclusion" class="level1">
<h1>Model Conclusion</h1>
<p>A hybrid recommender system was developed by combining behavioral (Item-Item Collaborative Filtering), semantic (Content-Based Filtering), and contextual (Association Rules) signals. The architecture ensures coverage, personalization, and cross-sell capability while respecting statistical data limitations and avoiding artificial recommendations. The model reflects real-world production practices and was incrementally evaluated, demonstrating qualitative gains in relevance and interpretability.</p>
</section>
<section id="cloud-deployment-aws" class="level1">
<h1>Cloud Deployment (AWS)</h1>
<p>This final stage transforms the developed model into a production-ready service, following offline training, versioned artifacts, and online inference via a serverless architecture.</p>
<p>The deployment was organized into two main phases:</p>
<section id="offline-artifacts-model-preparation-for-production" class="level2">
<h2 data-anchor-id="offline-artifacts-model-preparation-for-production">1️. Offline Artifacts — Model Preparation for Production</h2>
<p>Before any interaction with cloud infrastructure, the recommender system is frozen into static artifacts, trained and validated offline.</p>
<p>This approach follows a pattern widely adopted in real-world recommender systems:</p>
<blockquote class="blockquote">
<p><em>Training happens offline. In production, the API only loads artifacts and executes ranking.</em></p>
</blockquote>
<section id="what-is-saved-as-artifacts" class="level3">
<h3 data-anchor-id="what-is-saved-as-artifacts">What is saved as artifacts</h3>
<p>Files that represent the final state of the model, ensuring:</p>
<ul>
<li>Reproducibility</li>
<li>Low computational cost in production</li>
<li>Low response latency</li>
<li>Clear separation between training and inference</li>
</ul>
<section id="save-final-artifacts-of-the-built-hybrid-model" class="level5">
<h5 data-anchor-id="save-final-artifacts-of-the-built-hybrid-model">Save final artifacts of the built hybrid model:</h5>
<div id="e3d1e65c" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar diretório de artefatos</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>ARTIFACTS_DIR <span class="op">=</span> <span class="st">"artifacts"</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>os.makedirs(ARTIFACTS_DIR, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1️⃣ CF — Similaridade Item-Item</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/cf_similarity.pkl"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    pickle.dump(shrunk_similarity, f)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2️⃣ Content-Based — Similaridade TF-IDF</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/cb_similarity.pkl"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    pickle.dump(content_sim_df, f)</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 3️⃣ Association Rules</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/association_rules.pkl"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    pickle.dump(rules_filtered, f)</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 4️⃣ Products (metadata)</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>products.to_parquet(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/products.parquet"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 5️⃣ Interactions (histórico mínimo)</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>interactions.to_parquet(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/interactions.parquet"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Versões para deploy</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>products.to_csv(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/products.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>interactions.to_csv(<span class="ss">f"</span><span class="sc">{</span>ARTIFACTS_DIR<span class="sc">}</span><span class="ss">/interactions.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
</section>
<section id="aws-deployment" class="level2">
<h2 data-anchor-id="aws-deployment">2. AWS Deployment</h2>
<p>With the artifacts ready, the system is deployed using a serverless architecture on AWS, composed of three main services:</p>
<ul>
<li><strong>Amazon S3</strong> → artifact storage and versioning</li>
<li><strong>AWS Lambda</strong> → on-demand inference execution</li>
<li><strong>Amazon API Gateway</strong> → model exposure via a REST endpoint</li>
</ul>
<hr>
<section id="amazon-s3-model-artifact-storage" class="level3">
<h3 data-anchor-id="amazon-s3-model-artifact-storage">Amazon S3 — Model Artifact Storage</h3>
<p>In the first cloud deployment step, an S3 bucket is created to store all model artifacts.</p>
<p>S3 acts as the model storage layer, decoupled from inference logic</p>
<section id="s3-bucket-creation-and-artifact-upload" class="level5">
<h5 data-anchor-id="s3-bucket-creation-and-artifact-upload">S3 bucket creation and artifact upload:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video3" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS1-S3-bucket-creation.mp4"></video></div>
<hr>
</section>
</section>
<section id="aws-lambda-serving-the-recommender" class="level3">
<h3 data-anchor-id="aws-lambda-serving-the-recommender">AWS Lambda — Serving the Recommender</h3>
<p>With the artifacts available in S3, an AWS Lambda function is created with the responsibility to:</p>
<ul>
<li>Load artifacts during initialization</li>
<li>Receive requests containing user_id</li>
<li>Execute hybrid ranking (CF + CB + Association Rules)</li>
<li>Return recommendations in JSON format</li>
</ul>
<p>This separation ensures that Lambda performs inference only, keeping cost and operational complexity under control.</p>
<section id="lambda-function-creation-and-configuration" class="level5">
<h5 data-anchor-id="lambda-function-creation-and-configuration">Lambda function creation and configuration:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video4" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS2_FuncaoLambda.mp4"></video></div>
</section>
<section id="layer-configuration" class="level5">
<h5 data-anchor-id="layer-configuration">Layer configuration:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video5" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS3_Layer.mp4"></video></div>
</section>
<section id="function-testing" class="level4">
<h4 data-anchor-id="function-testing">Function testing:</h4>
<div class="quarto-video"><video id="video_shortcode_videojs_video6" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS4-TesteFuncao.mp4"></video></div>
</section>
</section>
<section id="api-gateway-rest-api-exposure" class="level3">
<h3 data-anchor-id="api-gateway-rest-api-exposure">API Gateway — REST API Exposure</h3>
<p>To make the system externally accessible, the Lambda function is integrated with Amazon API Gateway.</p>
<p>The result is a REST endpoint capable of returning personalized recommendations on demand, ready to be consumed by:</p>
<ul>
<li>Web frontends</li>
<li>Mobile applications</li>
<li>Internal e-commerce systems</li>
</ul>
<section id="api-gateway-creation-and-lambda-integration" class="level5">
<h5 data-anchor-id="api-gateway-creation-and-lambda-integration">API Gateway creation and Lambda integration:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video7" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS5-API-Gateway.mp4"></video></div>
<hr>
</section>
</section>
<section id="final-deployment-and-end-to-end-demonstration" class="level3">
<h3 data-anchor-id="final-deployment-and-end-to-end-demonstration">Final Deployment and End-to-End Demonstration:</h3>
<p>After configuring S3, Lambda, and API Gateway, the system is deployed and tested end-to-end.</p>
<section id="ui-demo-bucket-creation" class="level5">
<h5 data-anchor-id="ui-demo-bucket-creation">UI demo bucket creation:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video8" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS6-BucketUI-DEMO.mp4"></video></div>
</section>
<section id="demonstration-final-deployment-and-recommendation-api-call" class="level5">
<h5 data-anchor-id="demonstration-final-deployment-and-recommendation-api-call">Demonstration — final deployment and recommendation API call:</h5>
<div class="quarto-video"><video id="video_shortcode_videojs_video9" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="AWS7-FINAL-DMEO.mp4"></video></div>
<hr>
<p>This approach allows the model to evolve (retraining, new weights, new signals) without impacting the API, simply by replacing artifacts stored in S3.</p>
<hr>
</section>
</section>
</section>
</section>
<section id="project-conclusion" class="level1">
<h1>Project Conclusion</h1>
<p>This project demonstrates the construction of a hybrid recommender system that is interpretable and production-oriented, combining technical rigor with direct business impact.</p>
<p>The hybrid approach balances personalization, coverage, and cross-sell opportunities, reflecting real-world practices adopted by large-scale e-commerce platforms.</p>
<hr>
<section id="references" class="level2">
<h2 data-anchor-id="references">References</h2>
<p>This project was also inspired by the following published articles and resources on recommender systems:</p>
<p><strong>Design and Implementation of a Product Recommendation System with Association and Clustering Algorithms</strong> <a href="https://medium.com/data-science/mastering-customer-segmentation-using-credit-card-transaction-data-dc39a8465766">https://medium.com/data-science/mastering-customer-segmentation-using-credit-card-transaction-data-dc39a8465766</a></p>
<p><strong>Mastering Customer Segmentation using Credit Card Transaction Data</strong> <a href="https://www.sciencedirect.com/science/article/pii/S1877050923003289">https://www.sciencedirect.com/science/article/pii/S1877050923003289</a></p>
<p><strong>E-Commerce Product Recommendation System based on ML Algorithms</strong> <a href="https://arxiv.org/abs/2407.21026">https://arxiv.org/abs/2407.21026</a></p>
<p><strong>Mastering E-commerce Product Recommendations in Python</strong> <a href="https://medium.com/datafabrica/mastering-e-commerce-product-recommendations-in-python-7c12a4bf0c2c">https://medium.com/datafabrica/mastering-e-commerce-product-recommendations-in-python-7c12a4bf0c2c</a></p>
</section>
<section id="github-repository" class="level2">
<h2 data-anchor-id="github-repository">GitHub Repository</h2>
<p>Access all code, datasets, notebooks, and files for this project:</p>
<p><a href="https://github.com/FerreiraGabrielw/ds-recomendation-system-deploy" target="_blank" rel="noopener noreferrer">Click here to access</a></p>
<hr>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>videojs(video_shortcode_videojs_video1);</script>
<script>videojs(video_shortcode_videojs_video2);</script>
<script>videojs(video_shortcode_videojs_video3);</script>
<script>videojs(video_shortcode_videojs_video4);</script>
<script>videojs(video_shortcode_videojs_video5);</script>
<script>videojs(video_shortcode_videojs_video6);</script>
<script>videojs(video_shortcode_videojs_video7);</script>
<script>videojs(video_shortcode_videojs_video8);</script>
<script>videojs(video_shortcode_videojs_video9);</script>




</body></html>